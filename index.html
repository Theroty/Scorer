<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shuttle Master - Badminton Tournament Manager</title> 
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            transition: background-color 0.3s, color 0.3s;
        }
        .shuttle-spin {
            animation: spin 4s linear infinite;
        }
        @keyframes spin { 
            100% { transform: rotate(360deg); } 
        }
        .glass-panel-dark {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-panel-light {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .score-display {
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="app-container" class="p-4 md:p-8 max-w-7xl mx-auto opacity-0 transition-opacity duration-500">
        <!-- Application UI injected here -->
    </div>

    <script>
        // --- GLOBAL STATE ---
        let theme = localStorage.getItem('theme') || 'dark';
        let players = ["Sarathi", "Deepak", "Pradeep", "Mohan", "Charlesh", "Nadraj"];
        let matches = [];
        let tournamentStarted = false;
        let matchIdCounter = 1;
        let matchMode = 'doubles'; // 'singles' or 'doubles'

        // --- THEME UTILITIES ---
        const getThemeClass = (darkClass, lightClass) => theme === 'dark' ? darkClass : lightClass;
        const getPrimaryColorClass = (base) => theme === 'dark' ? `text-green-${base}` : `text-blue-${base}`;
        const getPrimaryBgClass = (base) => theme === 'dark' ? `bg-green-${base}` : `bg-blue-${base}`;
        const getPrimaryHoverClass = (base) => theme === 'dark' ? `hover:bg-green-${base}` : `hover:bg-blue-${base}`;
        const getPanelClass = () => theme === 'dark' ? 'glass-panel-dark' : 'glass-panel-light';
        const getTextMutedClass = () => theme === 'dark' ? 'text-slate-400' : 'text-gray-600';
        const getInputBorderClass = () => theme === 'dark' ? 'border-slate-600' : 'border-gray-300';
        const getInputBgClass = () => theme === 'dark' ? 'bg-slate-900' : 'bg-white';
        const getTextPanelClass = () => theme === 'dark' ? 'text-white' : 'text-gray-900';
        const getPanelHeaderBgClass = () => theme === 'dark' ? 'bg-slate-700' : 'bg-gray-200';
        const getTableBorderClass = () => theme === 'dark' ? 'border-slate-700/50' : 'border-gray-300';

        // --- CORE LOGIC ---

        function addPlayer() {
            const newPlayerName = $('#new-player-name').val().trim();
            if (newPlayerName && !players.includes(newPlayerName)) {
                players.push(newPlayerName);
                $('#new-player-name').val('');
                renderPlayers(); 
            }
        }

        function removePlayer(name) {
            players = players.filter(p => p !== name);
            renderPlayers();
        }

        function shufflePlayers() {
            players.sort(() => Math.random() - 0.5);
            renderPlayers();
        }

        function generateSchedule() {
            const minPlayers = matchMode === 'doubles' ? 4 : 2;
            if (players.length < minPlayers) {
                alert(`Need at least ${minPlayers} players for ${matchMode}.`);
                return;
            }

            matches = [];
            matchIdCounter = 1;
            let tempPlayers = [...players].sort(() => Math.random() - 0.5);

            if (matchMode === 'doubles') {
                // Simplified Round Robin Pairings for Doubles
                for (let i = 0; i < players.length; i++) {
                    for (let j = i + 1; j < players.length; j++) {
                        const team1 = [players[i], players[j]];
                        const available = players.filter(p => !team1.includes(p));
                        if (available.length >= 2) {
                            const team2 = available.slice(0, 2);
                            matches.push({
                                id: matchIdCounter++,
                                t1: team1,
                                t2: team2,
                                score1: 0,
                                score2: 0,
                                played: false,
                                type: "Normal"
                            });
                        }
                    }
                }
            } else {
                // Singles Pairings
                for (let i = 0; i < players.length; i++) {
                    for (let j = i + 1; j < players.length; j++) {
                        matches.push({
                            id: matchIdCounter++,
                            t1: [players[i]],
                            t2: [players[j]],
                            score1: 0,
                            score2: 0,
                            played: false,
                            type: "Normal"
                        });
                    }
                }
            }

            tournamentStarted = true;
            renderAll();
        }

        function updateScore(id, field, delta) {
            const match = matches.find(m => m.id === id);
            if (match) {
                match[field] = Math.max(0, match[field] + delta);
                match.played = (match.score1 > 0 || match.score2 > 0);
                renderLeaderboard();
                renderSchedule();
            }
        }

        function updateType(id, val) {
            const match = matches.find(m => m.id === id);
            if (match) {
                match.type = val;
                renderSchedule();
            }
        }

        function calculateLeaderboard() {
            const stats = {};
            players.forEach(p => {
                stats[p] = { name: p, played: 0, wins: 0, losses: 0, diff: 0, points: 0 };
            });

            matches.forEach(m => {
                if (m.played) {
                    const diff = m.score1 - m.score2;
                    m.t1.forEach(p => {
                        if (stats[p]) {
                            stats[p].played++;
                            stats[p].diff += diff;
                            if (m.score1 > m.score2) { stats[p].wins++; stats[p].points += 2; }
                            else if (m.score1 === m.score2) { stats[p].points += 1; }
                            else { stats[p].losses++; }
                        }
                    });
                    m.t2.forEach(p => {
                        if (stats[p]) {
                            stats[p].played++;
                            stats[p].diff -= diff;
                            if (m.score2 > m.score1) { stats[p].wins++; stats[p].points += 2; }
                            else if (m.score1 === m.score2) { stats[p].points += 1; }
                            else { stats[p].losses++; }
                        }
                    });
                }
            });

            return Object.values(stats).sort((a, b) => b.points - a.points || b.diff - a.diff);
        }

        function exportToCSV() {
            const leaderboardData = calculateLeaderboard();
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Rank,Player,Played,Wins,Losses,Diff,Points\n";
            leaderboardData.forEach((p, i) => {
                csvContent += `${i + 1},${p.name},${p.played},${p.wins},${p.losses},${p.diff},${p.points}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "tournament_results.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- RENDERING ---

        function renderPlayers() {
            const listHtml = players.map(p => `
                <div class="${getPanelHeaderBgClass()} px-3 py-1 rounded-full text-sm flex items-center transition">
                    ${p}
                    ${!tournamentStarted ? `<button data-name="${p}" class="remove-p ml-2 text-red-400"><i class="fa-solid fa-times text-xs"></i></button>` : ''}
                </div>
            `).join('');

            const cardHtml = `
                <div class="${getPanelClass()} rounded-xl p-6 shadow-lg mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fa-solid fa-users-gear mr-2 ${getPrimaryColorClass(400)}"></i> Tournament Setup
                    </h2>
                    
                    ${!tournamentStarted ? `
                        <div class="mb-4">
                            <label class="text-xs uppercase tracking-widest ${getTextMutedClass()} block mb-2 font-bold">Match Mode</label>
                            <div class="flex gap-2">
                                <button onclick="matchMode='singles'; renderPlayers();" class="flex-1 py-2 rounded border ${matchMode === 'singles' ? getPrimaryBgClass(600) + ' text-white border-transparent' : 'border-slate-600 ' + getTextMutedClass()} transition font-semibold">Singles</button>
                                <button onclick="matchMode='doubles'; renderPlayers();" class="flex-1 py-2 rounded border ${matchMode === 'doubles' ? getPrimaryBgClass(600) + ' text-white border-transparent' : 'border-slate-600 ' + getTextMutedClass()} transition font-semibold">Doubles</button>
                            </div>
                        </div>
                        <div class="flex gap-2 mb-4">
                            <input id="new-player-name" type="text" placeholder="Player Name" class="flex-1 ${getInputBgClass()} border ${getInputBorderClass()} rounded px-3 py-2 ${getTextPanelClass()} focus:ring-1 ${getThemeClass('focus:ring-green-500', 'focus:ring-blue-500')} outline-none" />
                            <button id="add-p-btn" class="${getPrimaryBgClass(600)} text-white px-4 rounded"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    ` : ''}

                    <div class="flex flex-wrap gap-2 mb-6">${listHtml}</div>

                    <div class="grid grid-cols-2 gap-3">
                        ${!tournamentStarted ? `
                            <button id="shuffle-btn" class="py-2 rounded bg-slate-600 text-white hover:bg-slate-500 transition"><i class="fa-solid fa-shuffle mr-2"></i> Shuffle</button>
                            <button id="start-btn" class="py-2 rounded ${getPrimaryBgClass(600)} text-white hover:opacity-90 transition font-bold">Start Match</button>
                        ` : `
                            <button id="reset-btn" class="col-span-2 py-2 rounded bg-red-600/20 text-red-400 border border-red-600/50 hover:bg-red-600 hover:text-white transition">Reset Tournament</button>
                        `}
                    </div>
                </div>
            `;
            $('#players-card').html(cardHtml);
            attachPlayerListeners();
        }

        function renderLeaderboard() {
            if (!tournamentStarted) return $('#leaderboard-card').html('');
            
            const data = calculateLeaderboard();
            const rows = data.map((p, i) => `
                <tr class="border-b ${getTableBorderClass()}">
                    <td class="py-3 font-medium">${i === 0 ? 'üèÜ ' : ''}${p.name}</td>
                    <td class="text-center">${p.played}</td>
                    <td class="text-center ${getPrimaryColorClass(400)} font-bold">${p.wins}</td>
                    <td class="text-center ${p.diff >= 0 ? 'text-green-400' : 'text-red-400'}">${p.diff > 0 ? '+' : ''}${p.diff}</td>
                    <td class="text-right font-black text-lg ${getTextPanelClass()}">${p.points}</td>
                </tr>
            `).join('');

            $('#leaderboard-card').html(`
                <div class="${getPanelClass()} rounded-xl p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold"><i class="fa-solid fa-ranking-star mr-2 text-yellow-500"></i> Rankings</h2>
                        <button onclick="exportToCSV()" class="text-xs bg-slate-700 px-2 py-1 rounded text-slate-300">Export</button>
                    </div>
                    <table class="w-full text-sm">
                        <thead class="${getTextMutedClass()} uppercase text-[10px] tracking-widest border-b ${getInputBorderClass()}">
                            <tr>
                                <th class="text-left pb-2">Player</th>
                                <th class="pb-2">P</th>
                                <th class="pb-2">W</th>
                                <th class="pb-2">+/-</th>
                                <th class="text-right pb-2">Pts</th>
                            </tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
            `);
        }

        function renderSchedule() {
            if (!tournamentStarted) {
                return $('#schedule-card').html(`
                    <div class="h-full flex flex-col items-center justify-center p-12 text-center ${getTextMutedClass()} border-2 border-dashed ${getInputBorderClass()} rounded-2xl">
                        <i class="fa-solid fa-calendar-plus text-5xl mb-4 opacity-20"></i>
                        <p class="text-lg">No matches scheduled yet.<br>Add players and click Start to begin.</p>
                    </div>
                `);
            }

            const matchesHtml = matches.map(m => `
                <div class="${getPanelClass()} border ${m.played ? getThemeClass('border-green-500/30 bg-green-500/5', 'border-blue-500/30 bg-blue-500/5') : getInputBorderClass()} rounded-xl p-5 relative overflow-hidden">
                    <div class="absolute top-0 right-0 px-3 py-1 text-[10px] font-bold uppercase tracking-tighter ${getThemeClass('bg-slate-700 text-slate-400', 'bg-gray-200 text-gray-500')}">Match #${m.id}</div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-7 items-center gap-4">
                        <!-- Team 1 -->
                        <div class="md:col-span-3 text-center">
                            <div class="font-bold text-lg mb-3 ${getTextPanelClass()}">
                                ${m.t1.join(' & ')}
                            </div>
                            <div class="flex items-center justify-center gap-3">
                                <button onclick="updateScore(${m.id}, 'score1', -1)" class="w-10 h-10 rounded-full border ${getInputBorderClass()} hover:bg-red-500/20 transition text-red-400"><i class="fa-solid fa-minus"></i></button>
                                <div class="w-16 h-12 flex items-center justify-center rounded-lg ${getInputBgClass()} border ${getInputBorderClass()} text-2xl font-black score-display">
                                    ${m.score1}
                                </div>
                                <button onclick="updateScore(${m.id}, 'score1', 1)" class="w-10 h-10 rounded-full border ${getInputBorderClass()} hover:${getPrimaryBgClass(500)}/20 transition ${getPrimaryColorClass(400)}"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>

                        <!-- VS Divider -->
                        <div class="md:col-span-1 flex flex-col items-center">
                            <span class="text-xs font-black opacity-30">VS</span>
                        </div>

                        <!-- Team 2 -->
                        <div class="md:col-span-3 text-center">
                            <div class="font-bold text-lg mb-3 ${getTextPanelClass()}">
                                ${m.t2.join(' & ')}
                            </div>
                            <div class="flex items-center justify-center gap-3">
                                <button onclick="updateScore(${m.id}, 'score2', -1)" class="w-10 h-10 rounded-full border ${getInputBorderClass()} hover:bg-red-500/20 transition text-red-400"><i class="fa-solid fa-minus"></i></button>
                                <div class="w-16 h-12 flex items-center justify-center rounded-lg ${getInputBgClass()} border ${getInputBorderClass()} text-2xl font-black score-display">
                                    ${m.score2}
                                </div>
                                <button onclick="updateScore(${m.id}, 'score2', 1)" class="w-10 h-10 rounded-full border ${getInputBorderClass()} hover:${getPrimaryBgClass(500)}/20 transition ${getPrimaryColorClass(400)}"><i class="fa-solid fa-plus"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 pt-4 border-t ${getInputBorderClass()} flex justify-between items-center">
                         <select onchange="updateType(${m.id}, this.value)" class="bg-transparent text-xs ${getTextMutedClass()} outline-none">
                            <option value="Normal" ${m.type==='Normal'?'selected':''}>Normal Match</option>
                            <option value="Final" ${m.type==='Final'?'selected':''}>Tournament Final</option>
                            <option value="Friendly" ${m.type==='Friendly'?'selected':''}>Friendly</option>
                        </select>
                        <span class="text-[10px] uppercase font-bold ${m.played ? getPrimaryColorClass(400) : 'text-orange-400'}">
                            ${m.played ? '<i class="fa-solid fa-check-double mr-1"></i> Completed' : '<i class="fa-solid fa-clock mr-1"></i> Pending'}
                        </span>
                    </div>
                </div>
            `).join('');

            $('#schedule-card').html(`
                <div class="space-y-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center ${getTextPanelClass()}">
                        <i class="fa-solid fa-calendar-days mr-2 ${getPrimaryColorClass(400)}"></i> Match Schedule
                    </h2>
                    <div class="grid grid-cols-1 gap-4">${matchesHtml}</div>
                </div>
            `);
        }

        function renderAll() {
            $('body').removeClass('bg-slate-900 text-slate-200 bg-gray-50 text-gray-900')
                     .addClass(getThemeClass('bg-slate-900 text-slate-200', 'bg-gray-50 text-gray-900'));

            $('#app-container').html(`
                <div class="flex justify-between items-center mb-10">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl ${getPrimaryBgClass(600)} flex items-center justify-center text-white text-2xl shadow-lg">
                            <i class="fa-solid fa-feather-pointed shuttle-spin"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-black tracking-tight ${getTextPanelClass()}">SHUTTLE MASTER</h1>
                            <p class="text-[10px] uppercase tracking-[0.2em] font-bold ${getPrimaryColorClass(500)}">Tournament Engine</p>
                        </div>
                    </div>
                    <button id="theme-btn" class="w-10 h-10 rounded-full bg-slate-800 text-yellow-400 flex items-center justify-center border border-slate-700">
                        <i class="fa-solid ${theme === 'dark' ? 'fa-sun' : 'fa-moon'}"></i>
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-4">
                        <div id="players-card"></div>
                        <div id="leaderboard-card"></div>
                    </div>
                    <div class="lg:col-span-8">
                        <div id="schedule-card"></div>
                    </div>
                </div>
            `);

            renderPlayers();
            renderLeaderboard();
            renderSchedule();
            
            $('#app-container').removeClass('opacity-0');
            attachGlobalListeners();
        }

        // --- LISTENERS ---

        function attachGlobalListeners() {
            $('#theme-btn').on('click', () => {
                theme = theme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', theme);
                renderAll();
            });
        }

        function attachPlayerListeners() {
            $('#add-p-btn').on('click', addPlayer);
            $('#new-player-name').on('keypress', e => e.key === 'Enter' && addPlayer());
            $('.remove-p').on('click', function() { removePlayer($(this).data('name')); });
            $('#shuffle-btn').on('click', shufflePlayers);
            $('#start-btn').on('click', generateSchedule);
            $('#reset-btn').on('click', () => {
                if (confirm("Reset everything? Match data will be cleared.")) {
                    tournamentStarted = false;
                    matches = [];
                    renderAll();
                }
            });
        }

        // Initialize
        $(document).ready(() => {
            renderAll();
            // Basic security
            document.addEventListener('contextmenu', e => e.preventDefault());
        });

    </script>
</body>
</html>
