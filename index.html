<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Tournament Manager</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Color is now managed by the root component */
            user-select: none;
            -webkit-user-select: none;
        }
        /* Dark Mode Glass Panel */
        .glass-panel-dark {
            background: rgba(30, 41, 59, 0.7); /* slate-800 */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Light Mode Glass Panel */
        .glass-panel-light {
            background: rgba(255, 255, 255, 0.8); /* white */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .shuttle-spin {
            animation: spin 3s linear infinite;
        }
        @keyframes spin { 
            100% { transform: rotate(360deg); } 
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            // --- State Initialization ---
            const [theme, setTheme] = useState(localStorage.getItem('theme') || 'dark');
            const [players, setPlayers] = useState([
                "Sarathi", "Deepak", "Pradeep", "Mohan", "Charlesh", "Nadraj"
            ]);
            const [matches, setMatches] = useState([]);
            const [tournamentStarted, setTournamentStarted] = useState(false);
            const [newPlayerName, setNewPlayerName] = useState("");

            // --- Logic: Theme Management & Persistence ---
            useEffect(() => {
                localStorage.setItem('theme', theme);
            }, [theme]);

            const toggleTheme = () => {
                setTheme(currentTheme => (currentTheme === 'dark' ? 'light' : 'dark'));
            };

            // Helper function to get dynamic classes
            const getThemeClass = (darkClass, lightClass) => theme === 'dark' ? darkClass : lightClass;
            const getPrimaryColorClass = (base) => theme === 'dark' ? `text-green-${base}` : `text-blue-${base}`;
            const getPrimaryBgClass = (base) => theme === 'dark' ? `bg-green-${base}` : `bg-blue-${base}`;
            const getPrimaryHoverClass = (base) => theme === 'dark' ? `hover:bg-green-${base}` : `hover:bg-blue-${base}`;
            const getPrimaryRingClass = () => theme === 'dark' ? `ring-green-500/50` : `ring-blue-500/50`;
            const getPanelClass = () => theme === 'dark' ? 'glass-panel-dark' : 'glass-panel-light';
            const getTextMutedClass = () => theme === 'dark' ? 'text-slate-400' : 'text-gray-600';
            const getInputBorderClass = () => theme === 'dark' ? 'border-slate-600' : 'border-gray-300';
            const getInputBgClass = () => theme === 'dark' ? 'bg-slate-800' : 'bg-white';
            const getPanelBorderClass = () => theme === 'dark' ? 'border-slate-600' : 'border-gray-200';
            const getPanelHeaderBgClass = () => theme === 'dark' ? 'bg-slate-700' : 'bg-gray-200';
            const getTextPanelClass = () => theme === 'dark' ? 'text-white' : 'text-gray-900';
            const getTableBorderClass = () => theme === 'dark' ? 'border-slate-700/50' : 'border-gray-300';


            // --- Logic: Prevent Accidental Reload (Unchanged) ---
            useEffect(() => {
                const handleBeforeUnload = (e) => {
                    if (tournamentStarted) {
                        e.preventDefault();
                        e.returnValue = ''; // Chrome requires returnValue to be set
                    }
                };

                window.addEventListener('beforeunload', handleBeforeUnload);

                return () => {
                    window.removeEventListener('beforeunload', handleBeforeUnload);
                };
            }, [tournamentStarted]);

            // --- Logic: Disable Developer Tools (Right-click, F12, Ctrl+Shift+I, etc.) (Unchanged) ---
            useEffect(() => {
                const handleContextMenu = (e) => {
                    e.preventDefault();
                };

                const handleKeyDown = (e) => {
                    // F12
                    if (e.keyCode === 123) {
                        e.preventDefault();
                    }
                    // Ctrl+Shift+I (Inspect) or Ctrl+Shift+J (Console) or Ctrl+Shift+C
                    if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C' || e.key === 'i' || e.key === 'j' || e.key === 'c')) {
                        e.preventDefault();
                    }
                    // Ctrl+U (View Source)
                    if (e.ctrlKey && (e.key === 'U' || e.key === 'u')) {
                        e.preventDefault();
                    }
                };

                document.addEventListener('contextmenu', handleContextMenu);
                document.addEventListener('keydown', handleKeyDown);

                return () => {
                    document.removeEventListener('contextmenu', handleContextMenu);
                    document.removeEventListener('keydown', handleKeyDown);
                };
            }, []);

            // --- Logic: Player Management (Unchanged) ---
            const addPlayer = () => {
                if (newPlayerName.trim() && !players.includes(newPlayerName)) {
                    setPlayers([...players, newPlayerName.trim()]);
                    setNewPlayerName("");
                }
            };

            const removePlayer = (index) => {
                const newPlayers = [...players];
                newPlayers.splice(index, 1);
                setPlayers(newPlayers);
            };

            const shufflePlayers = () => {
                const shuffled = [...players].sort(() => Math.random() - 0.5);
                setPlayers(shuffled);
            };

            // --- Logic: Scheduling (Unchanged) ---
            const generateSchedule = () => {
                if (players.length < 4) {
                    // Use a custom message box instead of alert in production, but for simplicity here:
                    console.log("Need at least 4 players for doubles."); 
                    return;
                }

                let newMatches = [];
                let matchId = 1;

                let allPairs = [];
                for (let i = 0; i < players.length; i++) {
                    for (let j = i + 1; j < players.length; j++) {
                        allPairs.push([players[i], players[j]]);
                    }
                }

                allPairs.sort(() => Math.random() - 0.5);

                allPairs.forEach((pair1) => {
                    const p1 = pair1[0];
                    const p2 = pair1[1];
                    const availableOpponents = players.filter(p => p !== p1 && p !== p2);
                    
                    const shuffledOpp = availableOpponents.sort(() => Math.random() - 0.5);
                    const opp1 = shuffledOpp[0];
                    const opp2 = shuffledOpp[1];

                    newMatches.push({
                        id: matchId++,
                        t1: [p1, p2],
                        t2: [opp1, opp2],
                        score1: 0,
                        score2: 0,
                        played: false,
                        type: "Normal"
                    });
                });

                setMatches(newMatches);
                setTournamentStarted(true);
            };

            // --- Logic: Score Updates (Unchanged) ---
            const updateScore = (id, field, value) => {
                const updatedMatches = matches.map(m => {
                    if (m.id === id) {
                        const val = parseInt(value) || 0;
                        const newMatch = { ...m, [field]: val };
                        // Mark as played if at least one score is entered
                        if (newMatch.score1 > 0 || newMatch.score2 > 0) newMatch.played = true;
                        return newMatch;
                    }
                    return m;
                });
                setMatches(updatedMatches);
            };

            const updateType = (id, val) => {
                setMatches(matches.map(m => m.id === id ? { ...m, type: val } : m));
            };

            // --- Logic: Leaderboard Calculation (Unchanged) ---
            const leaderboard = useMemo(() => {
                const stats = {};
                
                // Initialize
                players.forEach(p => {
                    stats[p] = { name: p, played: 0, wins: 0, losses: 0, diff: 0, points: 0 };
                });

                matches.forEach(m => {
                    if (m.played) {
                        const team1 = m.t1;
                        const team2 = m.t2;
                        const s1 = m.score1;
                        const s2 = m.score2;
                        const diff = s1 - s2;

                        // Team 1 Stats
                        team1.forEach(p => {
                            if(stats[p]) {
                                stats[p].played += 1;
                                stats[p].diff += diff;
                                if (s1 > s2) { stats[p].wins += 1; stats[p].points += 2; }
                                else if (s1 === s2) { stats[p].points += 1; }
                                else { stats[p].losses += 1; }
                            }
                        });

                        // Team 2 Stats
                        team2.forEach(p => {
                            if(stats[p]) {
                                stats[p].played += 1;
                                stats[p].diff -= diff;
                                if (s2 > s1) { stats[p].wins += 1; stats[p].points += 2; }
                                else if (s1 === s2) { stats[p].points += 1; }
                                else { stats[p].losses += 1; }
                            }
                        });
                    }
                });

                return Object.values(stats).sort((a, b) => b.points - a.points || b.diff - a.diff);
            }, [matches, players]);

            // --- Logic: Export to CSV (Unchanged) ---
            const exportToCSV = () => {
                let csvContent = "data:text/csv;charset=utf-8,";
                
                // Section 1: Leaderboard
                csvContent += "LEADERBOARD\n";
                csvContent += "Rank,Player,Matches Played,Wins,Losses,Score Diff,Points\n";
                leaderboard.forEach((p, index) => {
                    csvContent += `${index + 1},${p.name},${p.played},${p.wins},${p.losses},${p.diff},${p.points}\n`;
                });

                csvContent += "\nMATCH SCHEDULE\n";
                csvContent += "Match ID,Team 1 P1,Team 1 P2,Team 2 P1,Team 2 P2,Score T1,Score T2,Playing Type\n";
                matches.forEach(m => {
                    csvContent += `${m.id},${m.t1[0]},${m.t1[1]},${m.t2[0]},${m.t2[1]},${m.score1},${m.score2},${m.type}\n`;
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "badminton_tournament.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className={`min-h-screen p-4 md:p-8 max-w-7xl mx-auto ${getThemeClass('bg-slate-900 text-slate-200', 'bg-gray-100 text-gray-900')}`}>
                    {/* Header */}
                    <div className="text-center mb-8 flex flex-col items-center">
                        <div className="w-full flex justify-end">
                            <button 
                                onClick={toggleTheme} 
                                className={`p-2 rounded-full transition ${getThemeClass('bg-slate-800 hover:bg-slate-700 text-slate-300', 'bg-gray-200 hover:bg-gray-300 text-gray-600')}`}
                                title={theme === 'dark' ? "Switch to Day Mode" : "Switch to Night Mode"}
                            >
                                <i className={theme === 'dark' ? "fa-solid fa-sun" : "fa-solid fa-moon"}></i>
                            </button>
                        </div>
                        <h1 className={`text-4xl md:text-5xl font-bold ${getPrimaryColorClass(400)} mb-2 -mt-10`}>
                            <i className="fa-solid fa-feather-pointed mr-3 shuttle-spin"></i>
                            Shuttle Master
                        </h1>
                        <p className={getTextMutedClass()}>Tournament Scheduler & Scorer</p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                        
                        {/* LEFT COLUMN: Setup & Leaderboard */}
                        <div className="lg:col-span-4 space-y-6">
                            
                            {/* Players Card */}
                            <div className={`${getPanelClass()} rounded-xl p-6 shadow-lg`}>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className={`text-xl font-bold ${getTextPanelClass()}`}><i className="fa-solid fa-users mr-2"></i> Players</h2>
                                    <span className={`${getPanelHeaderBgClass()} px-2 py-1 rounded text-xs ${getTextMutedClass()}`}>{players.length} Players</span>
                                </div>
                                
                                {!tournamentStarted && (
                                    <div className="flex gap-2 mb-4">
                                        <input 
                                            type="text" 
                                            className={`w-full ${getInputBgClass()} ${getInputBorderClass()} rounded px-3 py-2 ${getTextPanelClass()} focus:outline-none focus:border-green-500`}
                                            placeholder="Add player..."
                                            value={newPlayerName}
                                            onChange={(e) => setNewPlayerName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && addPlayer()}
                                        />
                                        <button onClick={addPlayer} className={`${getPrimaryBgClass(600)} ${getPrimaryHoverClass(700)} text-white px-4 rounded transition`}>
                                            <i className="fa-solid fa-plus"></i>
                                        </button>
                                    </div>
                                )}

                                <div className="flex flex-wrap gap-2 mb-4">
                                    {players.map((p, idx) => (
                                        <div key={idx} className={`group relative ${getPanelHeaderBgClass()} ${getThemeClass('hover:bg-slate-600', 'hover:bg-gray-300')} px-3 py-1 rounded-full text-sm flex items-center transition cursor-default`}>
                                            {p}
                                            {!tournamentStarted && (
                                                <button onClick={() => removePlayer(idx)} className="ml-2 text-red-400 hover:text-red-300">
                                                    <i className="fa-solid fa-times"></i>
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>

                                {!tournamentStarted ? (
                                    <div className="flex gap-2">
                                        <button onClick={shufflePlayers} className={`flex-1 ${getThemeClass('bg-slate-600 hover:bg-slate-500', 'bg-gray-400 hover:bg-gray-500')} py-2 rounded text-white font-semibold transition`}>
                                            <i className="fa-solid fa-shuffle mr-2"></i> Shuffle
                                        </button>
                                        <button onClick={generateSchedule} className={`flex-1 ${getPrimaryBgClass(600)} ${getPrimaryHoverClass(500)} py-2 rounded text-white font-semibold transition`}>
                                            Start <i className="fa-solid fa-play ml-2"></i>
                                        </button>
                                    </div>
                                ) : (
                                    <button onClick={() => {if(confirm("Reset tournament? All scores will be lost.")) {setTournamentStarted(false); setMatches([]);}}} className="w-full bg-red-900/50 hover:bg-red-900 text-red-200 py-2 rounded border border-red-800 transition">
                                        Reset Tournament
                                    </button>
                                )}
                            </div>

                            {/* Leaderboard Card */}
                            {tournamentStarted && (
                                <div className={`${getPanelClass()} rounded-xl p-6 shadow-lg border-t-4 ${theme === 'dark' ? 'border-t-yellow-500' : 'border-t-yellow-600'}`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className={`text-xl font-bold ${getTextPanelClass()}`}><i className={`fa-solid fa-trophy mr-2 ${theme === 'dark' ? 'text-yellow-400' : 'text-yellow-600'}`}></i> Standings</h2>
                                        <button onClick={exportToCSV} className={`text-xs ${getPrimaryBgClass(800)} ${getPrimaryHoverClass(700)} ${getPrimaryColorClass(100)} px-2 py-1 rounded`}>
                                            <i className="fa-solid fa-file-excel mr-1"></i> Export Excel
                                        </button>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className={`${getTextMutedClass()} border-b ${getInputBorderClass()}`}>
                                                <tr>
                                                    <th className="py-2">Player</th>
                                                    <th className="py-2 text-center">P</th>
                                                    <th className="py-2 text-center">W</th>
                                                    <th className="py-2 text-center">Diff</th>
                                                    <th className="py-2 text-right">Pts</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {leaderboard.map((p, i) => (
                                                    <tr key={i} className={`border-b ${getTableBorderClass()} ${getThemeClass('hover:bg-slate-700/30', 'hover:bg-gray-200/50')} transition`}>
                                                        <td className="py-2 font-medium">
                                                            {i===0 && <i className={`fa-solid fa-crown mr-1 ${theme === 'dark' ? 'text-yellow-500' : 'text-yellow-600'}`}></i>}
                                                            {p.name}
                                                        </td>
                                                        <td className={`py-2 text-center ${getTextMutedClass()}`}>{p.played}</td>
                                                        <td className={`py-2 text-center ${getPrimaryColorClass(400)}`}>{p.wins}</td>
                                                        <td className={`py-2 text-center ${p.diff > 0 ? getPrimaryColorClass(400) : 'text-red-400'}`}>{p.diff > 0 ? `+${p.diff}` : p.diff}</td>
                                                        <td className={`py-2 text-right font-bold ${getTextPanelClass()}`}>{p.points}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* RIGHT COLUMN: Schedule */}
                        <div className="lg:col-span-8">
                            <div className={`${getPanelClass()} rounded-xl p-6 shadow-lg min-h-[600px]`}>
                                <h2 className={`text-xl font-bold ${getTextPanelClass()} mb-6 flex items-center`}>
                                    <i className="fa-regular fa-calendar-check mr-2"></i> 
                                    Match Schedule
                                    {tournamentStarted && <span className={`ml-3 text-sm font-normal ${getTextMutedClass()}`}>({matches.length} Matches Generated - Partner Rotation)</span>}
                                </h2>

                                {!tournamentStarted ? (
                                    <div className={`flex flex-col items-center justify-center h-64 ${getTextMutedClass()} border-2 border-dashed ${getPanelBorderClass()} rounded-xl`}>
                                        <i className="fa-solid fa-clipboard-list text-4xl mb-4"></i>
                                        <p>Add players and click Start to generate fixtures.</p>
                                    </div>
                                ) : (
                                    <div className="grid gap-4">
                                        {matches.map((match) => (
                                            <div key={match.id} className={`relative rounded-lg p-4 transition-all duration-200 border ${getThemeClass('bg-slate-800/80 border-slate-600', 'bg-white/80 border-gray-300')} ${match.played ? getThemeClass('bg-slate-800/80 border-slate-600', 'bg-gray-100/90 border-gray-300') : getThemeClass('bg-slate-800/40 border-slate-700', 'bg-white/70 border-gray-300')}`}>
                                                <div className="absolute top-2 left-3 text-xs text-slate-500 font-mono">Match #{match.id}</div>
                                                
                                                <div className="flex flex-col md:flex-row items-center justify-between gap-4 mt-4">
                                                    
                                                    {/* Team 1 */}
                                                    <div className={`flex-1 flex flex-col items-center p-2 rounded ${match.score1 > match.score2 && match.played ? `${getPrimaryBgClass(900)}/20 ring-1 ${getPrimaryRingClass()}` : ''}`}>
                                                        <div className={`flex gap-2 mb-2 font-semibold text-lg ${getTextPanelClass()}`}>
                                                            <span>{match.t1[0]}</span> & <span>{match.t1[1]}</span>
                                                        </div>
                                                        <input 
                                                            type="number" 
                                                            value={match.score1} 
                                                            onChange={(e) => updateScore(match.id, 'score1', e.target.value)}
                                                            className={`${getThemeClass('bg-slate-900', 'bg-gray-200')} text-center text-2xl font-bold w-20 py-1 rounded border ${getInputBorderClass()} ${getTextPanelClass()} focus:border-green-500 focus:outline-none`}
                                                        />
                                                    </div>

                                                    {/* VS Badge */}
                                                    <div className={`font-bold text-xl px-2 ${getTextMutedClass()}`}>VS</div>

                                                    {/* Team 2 */}
                                                    <div className={`flex-1 flex flex-col items-center p-2 rounded ${match.score2 > match.score1 && match.played ? `${getPrimaryBgClass(900)}/20 ring-1 ${getPrimaryRingClass()}` : ''}`}>
                                                        <div className={`flex gap-2 mb-2 font-semibold text-lg ${getTextPanelClass()}`}>
                                                            <span>{match.t2[0]}</span> & <span>{match.t2[1]}</span>
                                                        </div>
                                                        <input 
                                                            type="number" 
                                                            value={match.score2} 
                                                            onChange={(e) => updateScore(match.id, 'score2', e.target.value)}
                                                            className={`${getThemeClass('bg-slate-900', 'bg-gray-200')} text-center text-2xl font-bold w-20 py-1 rounded border ${getInputBorderClass()} ${getTextPanelClass()} focus:border-green-500 focus:outline-none`}
                                                        />
                                                    </div>
                                                </div>

                                                {/* Meta Data */}
                                                <div className={`mt-4 pt-3 border-t ${getPanelBorderClass()} flex items-center gap-2`}>
                                                    <span className={`text-xs ${getTextMutedClass()} uppercase tracking-wider`}>Play Type:</span>
                                                    <select 
                                                        value={match.type} 
                                                        onChange={(e) => updateType(match.id, e.target.value)}
                                                        className={`${getThemeClass('bg-slate-900 text-slate-300 border-slate-600', 'bg-gray-200 text-gray-800 border-gray-300')} text-xs rounded px-2 py-1 focus:outline-none`}
                                                    >
                                                        <option value="Normal">Normal</option>
                                                        <option value="Smash Heavy">Smash Heavy</option>
                                                        <option value="Drop Game">Drop Game</option>
                                                        <option value="Rally">Long Rally</option>
                                                        <option value="Net Play">Net Play</option>
                                                    </select>
                                                    
                                                    {match.played && (
                                                        <span className={`ml-auto text-xs ${getTextMutedClass()}`}>
                                                            Diff: {Math.abs(match.score1 - match.score2)}
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
